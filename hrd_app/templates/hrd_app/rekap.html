{% extends 'hrd_app/base.html' %}

{% block content %}

<style>
    /* =============================================
   TAMPILAN LAYAR (web)
   ============================================= */
    @media screen {
        #print-area {
            display: none;
        }

        .web-header {
            margin: 2rem 0 1.5rem;
        }

        .web-header h2 {
            font-weight: 700;
            letter-spacing: -1px;
        }
    }

    /* =============================================
   TAMPILAN CETAK (print)
   ============================================= */
    @media print {

        /* Sembunyikan semua elemen web */
        #web-area {
            display: none !important;
        }

        /* Sembunyikan chrome browser (navbar, dsb via base.html) */
        nav,
        .navbar,
        footer,
        .alert,
        .no-print,
        .sidebar,
        .topbar,
        header {
            display: none !important;
        }

        /* Reset halaman */
        @page {
            size: A4 portrait;
            margin: 12mm 14mm 14mm 14mm;
        }

        html,
        body {
            background: #fff !important;
            color: #111 !important;
            font-family: Arial, Helvetica, sans-serif !important;
            font-size: 9pt !important;
            margin: 0 !important;
            padding: 0 !important;
        }

        /* Tampilkan area cetak */
        #print-area {
            display: block !important;
            width: 100% !important;
        }

        /* === KOP DOKUMEN === */
        .kop {
            border-bottom: 2.5pt solid #111;
            padding-bottom: 8pt;
            margin-bottom: 10pt;
            display: flex;
            justify-content: space-between;
            align-items: flex-end;
        }

        .kop-kiri h1 {
            font-size: 13pt;
            font-weight: bold;
            margin: 0 0 2pt 0;
            color: #111;
        }

        .kop-kiri p {
            font-size: 8pt;
            color: #555;
            margin: 0;
        }

        .kop-kanan {
            text-align: right;
        }

        .kop-kanan .judul-dok {
            font-size: 12pt;
            font-weight: bold;
            color: #111;
        }

        .kop-kanan .info-tanggal {
            font-size: 8pt;
            color: #555;
            margin-top: 3pt;
        }

        /* === INFO REKAP === */
        .info-rekap {
            background: #f5f5f5;
            border: 1pt solid #ccc;
            padding: 5pt 10pt;
            margin-bottom: 10pt;
            font-size: 8pt;
            display: flex;
            gap: 20pt;
        }

        .info-rekap span {
            color: #333;
        }

        .info-rekap strong {
            color: #111;
        }

        /* === TABEL === */
        table.rekap-tabel {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 12pt;
        }

        table.rekap-tabel thead tr {
            background: #222 !important;
            -webkit-print-color-adjust: exact;
            print-color-adjust: exact;
        }

        table.rekap-tabel thead th {
            color: #fff !important;
            font-size: 8pt;
            font-weight: bold;
            padding: 6pt 7pt;
            border: 1pt solid #444;
            text-transform: uppercase;
            letter-spacing: 0.3pt;
        }

        table.rekap-tabel tbody td {
            border: 1pt solid #ccc;
            padding: 6pt 7pt;
            font-size: 8.5pt;
            vertical-align: middle;
            color: #111;
        }

        table.rekap-tabel tbody tr:nth-child(even) td {
            background: #fafafa !important;
            -webkit-print-color-adjust: exact;
            print-color-adjust: exact;
        }

        /* Lebar kolom (Tanpa Foto) */
        .col-no {
            width: 5%;
            text-align: center;
        }

        .col-nik {
            width: 12%;
            text-align: center;
        }

        .col-nama {
            width: 30%;
            font-weight: bold;
        }

        .col-dept {
            width: 18%;
        }

        .col-masuk {
            width: 11%;
            text-align: center;
            font-weight: bold;
            color: #1a5c2a;
        }

        .col-pulang {
            width: 12%;
            text-align: center;
            font-weight: bold;
            color: #1a3d6e;
        }

        .col-status {
            width: 12%;
            text-align: center;
        }

        /* Warna status */
        .status-selesai {
            background: #d6f0dd !important;
            color: #1a5c2a !important;
            border: 1pt solid #8ccf9a !important;
            padding: 2pt 7pt;
            border-radius: 3pt;
            font-size: 7.5pt;
            font-weight: bold;
            -webkit-print-color-adjust: exact;
            print-color-adjust: exact;
        }

        .status-aktif {
            background: #fff3cd !important;
            color: #7a5c00 !important;
            border: 1pt solid #f0c040 !important;
            padding: 2pt 7pt;
            border-radius: 3pt;
            font-size: 7.5pt;
            font-weight: bold;
            -webkit-print-color-adjust: exact;
            print-color-adjust: exact;
        }


        /* === FOOTER TTD === */
        .footer-ttd {
            margin-top: 16pt;
            border-top: 1pt solid #bbb;
            padding-top: 10pt;
            display: flex;
            justify-content: space-around;
        }

        .ttd-item {
            text-align: center;
            width: 30%;
        }

        .ttd-item .ttd-judul {
            font-size: 8pt;
            font-weight: bold;
            margin-bottom: 30pt;
        }

        .ttd-item .ttd-garis {
            border-top: 1pt solid #111;
            margin-bottom: 4pt;
        }

        .ttd-item .ttd-nama {
            font-size: 8pt;
            font-weight: bold;
        }

        .ttd-item .ttd-jabatan {
            font-size: 7.5pt;
            color: #555;
        }

        /* Info cetak bawah */
        .footer-info {
            margin-top: 8pt;
            text-align: right;
            font-size: 7pt;
            color: #888;
        }

        /* Matikan semua efek animasi/glassmorphism */
        * {
            animation: none !important;
            transition: none !important;
            box-shadow: none !important;
            text-shadow: none !important;
            backdrop-filter: none !important;
            -webkit-backdrop-filter: none !important;
        }
    }
</style>

<!-- ================================================
     TAMPILAN WEB
     ================================================ -->
<div id="web-area">
    <div class="web-header row align-items-center mb-4">
        <div class="col-md-8">
            <h2 class="text-white mb-1">Rekap Absensi Harian</h2>
            <p class="text-muted mb-0">Laporan kehadiran seluruh karyawan hari ini.</p>
        </div>
        <div class="col-md-4 text-md-end">
            <div class="p-3 glass-panel d-inline-block text-start" style="border-radius:12px;">
                <span class="text-primary fw-bold small text-uppercase" style="letter-spacing:1px;">Tanggal</span>
                <h5 class="mb-0 fw-bold text-white">{{ today|date:"d F Y" }}</h5>
            </div>
        </div>
    </div>

    <div class="card card-body p-0 overflow-hidden shadow-lg mb-4">
        <div class="table-responsive">
            <table class="table align-middle mb-0">
                <thead>
                    <tr>
                        <th class="px-3 py-3 text-center">#</th>
                        <th class="px-3 py-3">NIK</th>
                        <th class="px-3 py-3">Karyawan</th>
                        <th class="px-3 py-3">Departemen</th>
                        <th class="px-3 py-3 text-center">Masuk</th>
                        <th class="px-3 py-3 text-center">Pulang</th>
                        <th class="px-3 py-3 text-center">Selfie</th>
                        <th class="px-3 py-3 text-center">Status</th>
                    </tr>
                </thead>
                <tbody>
                    {% for item in laporan %}
                    <tr>
                        <td class="px-3 py-3 text-center text-muted small">{{ forloop.counter }}</td>
                        <td class="px-3 py-3 text-secondary small fw-semibold">{{ item.employee.employee_id }}</td>
                        <td class="px-3 py-3 fw-bold">{{ item.employee.name }}</td>
                        <td class="px-3 py-3 text-muted small">{{ item.employee.department.name|default:"-" }}</td>
                        <td class="px-3 py-3 text-center">
                            <span class="text-success fw-bold">{{ item.check_in|time:"H:i" }}</span>
                        </td>
                        <td class="px-3 py-3 text-center">
                            {% if item.check_out %}
                            <span class="text-primary fw-bold">{{ item.check_out|time:"H:i" }}</span>
                            {% else %}
                            <span class="text-muted fst-italic small">Belum Pulang</span>
                            {% endif %}
                        </td>
                        <td class="px-3 py-3 text-center">
                            <div class="d-flex justify-content-center gap-2">
                                {% if item.photo_in %}
                                <a href="{{ item.photo_in.url }}" target="_blank" title="Foto Masuk">
                                    <img src="{{ item.photo_in.url }}" class="rounded border"
                                        style="width:38px;height:38px;object-fit:cover;">
                                </a>
                                {% else %}
                                <span class="text-muted">-</span>
                                {% endif %}
                                {% if item.photo_out %}
                                <a href="{{ item.photo_out.url }}" target="_blank" title="Foto Pulang">
                                    <img src="{{ item.photo_out.url }}" class="rounded border"
                                        style="width:38px;height:38px;object-fit:cover;">
                                </a>
                                {% endif %}
                            </div>
                        </td>
                        <td class="px-3 py-3 text-center">
                            {% if item.check_out %}
                            <span class="badge rounded-pill bg-success-subtle text-success px-3">Selesai</span>
                            {% else %}
                            <span class="badge rounded-pill bg-warning-subtle text-warning px-3">Aktif</span>
                            {% endif %}
                        </td>
                    </tr>
                    {% empty %}
                    <tr>
                        <td colspan="8" class="text-center py-5 text-muted">
                            <i class="fas fa-clipboard-list fa-3x mb-3 d-block opacity-25"></i>
                            Belum ada data absensi untuk hari ini.
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        <div class="d-flex justify-content-end p-3">
            <button onclick="window.print()" class="btn btn-outline-secondary no-print">
                <i class="fas fa-print me-2"></i>Cetak Laporan
            </button>
        </div>
    </div>
</div>

<!-- ================================================
     AREA CETAK
     ================================================ -->
<div id="print-area">

    <!-- Kop Dokumen -->
    <div class="kop">
        <div class="kop-kiri">
            <h1>HRD APP</h1>
            <p>Sistem Manajemen SDM &bull; Bandung, Jawa Barat</p>
        </div>
        <div class="kop-kanan">
            <div class="judul-dok">REKAP ABSENSI HARIAN</div>
            <div class="info-tanggal">
                Tanggal&nbsp;: {{ today|date:"d F Y" }}<br>
                Dicetak&nbsp;: {% now "d/m/Y H:i" %} WIB
            </div>
        </div>
    </div>

    <!-- Info Ringkas -->
    <div class="info-rekap">
        <span><strong>Periode:</strong> {{ today|date:"d F Y" }}</span>
        <span><strong>Total Hadir:</strong> {{ laporan|length }} karyawan</span>
        <span><strong>Sumber:</strong> Sistem Absensi HRD Otomatis</span>
    </div>

    <!-- Tabel -->
    <table class="rekap-tabel">
        <thead>
            <tr>
                <th class="col-no">No.</th>
                <th class="col-nik">NIK</th>
                <th class="col-nama">Nama Karyawan</th>
                <th class="col-dept">Departemen</th>
                <th class="col-masuk">Jam Masuk</th>
                <th class="col-pulang">Jam Pulang</th>
                <th class="col-status">Status</th>
            </tr>
        </thead>
        <tbody>
            {% for item in laporan %}
            <tr>
                <td class="col-no">{{ forloop.counter }}</td>
                <td class="col-nik">{{ item.employee.employee_id }}</td>
                <td class="col-nama">{{ item.employee.name }}</td>
                <td class="col-dept">{{ item.employee.department.name|default:"-" }}</td>
                <td class="col-masuk">{{ item.check_in|time:"H:i" }}</td>
                <td class="col-pulang">
                    {% if item.check_out %}
                    {{ item.check_out|time:"H:i" }}
                    {% else %}
                    <span style="color:#aaa;font-style:italic;">-</span>
                    {% endif %}
                </td>
                <td class="col-status">
                    {% if item.check_out %}
                    <span class="status-selesai">Selesai</span>
                    {% else %}
                    <span class="status-aktif">Aktif</span>
                    {% endif %}
                </td>
            </tr>
            {% empty %}
            <tr>
                <td colspan="7" style="text-align:center;padding:16pt;color:#999;font-style:italic;">
                    Tidak ada data absensi untuk hari ini.
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>

    <!-- Footer Tanda Tangan -->
    <div class="footer-ttd">
        <div class="ttd-item">
            <div class="ttd-judul">Mengetahui,</div>
            <div class="ttd-garis"></div>
            <div class="ttd-nama">Direktur / Pimpinan</div>
        </div>
        <div class="ttd-item">
            <div class="ttd-judul">Diperiksa oleh,</div>
            <div class="ttd-garis"></div>
            <div class="ttd-nama">Kepala Departemen</div>
        </div>
        <div class="ttd-item">
            <div class="ttd-judul">Dibuat oleh,</div>
            <div class="ttd-garis"></div>
            <div class="ttd-nama">Bagian HRD</div>
        </div>
    </div>

    <!-- Info cetak -->
    <div class="footer-info">
        Dicetak dari Sistem HRD &bull; {{ today|date:"d F Y" }}
    </div>

</div>
{% endblock %}