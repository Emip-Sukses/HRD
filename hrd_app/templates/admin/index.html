{% extends "admin/index.html" %}
{% load i18n static admin_stats %}

{% block extrahead %}
{{ block.super }}
<link rel="stylesheet" href="{% static 'hrd_app/css/admin_glass_v2.css' %}">
{% endblock %}

{% block content %}
{% get_admin_stats as stats %}

<div class="dashboard-header mb-4 animate-fade-in px-2">
    <h1 class="m-0 fw-bold" style="font-size: 2.5rem; letter-spacing: -1.5px; color: #e2e8f0;">Dashboard</h1>
    <p style="color: #94a3b8; margin-top: 5px;">Ringkasan aktivitas sistem HR</p>
</div>

<!-- Summary Grid (4 Cards) -->
<div class="summary-grid animate-fade-in">
    <div class="stat-card">
        <div class="summary-icon icon-blue">
            <i class="fas fa-users"></i>
        </div>
        <div class="summary-info">
            <div class="label">Total Karyawan</div>
            <div class="value">{{ stats.total_employees }}</div>
        </div>
    </div>

    <div class="stat-card">
        <div class="summary-icon icon-indigo">
            <i class="fas fa-building"></i>
        </div>
        <div class="summary-info">
            <div class="label">Departemen</div>
            <div class="value">{{ stats.total_departments }}</div>
        </div>
    </div>

    <div class="stat-card">
        <div class="summary-icon icon-green">
            <i class="fas fa-calendar-check"></i>
        </div>
        <div class="summary-info">
            <div class="label">Hadir Hari ini</div>
            <div class="value">{{ stats.present_today }}</div>
        </div>
    </div>

    <div class="stat-card">
        <div class="summary-icon icon-orange">
            <i class="fas fa-check-square"></i>
        </div>
        <div class="summary-info">
            <div class="label">Izin</div>
            <div class="value">{{ stats.izin_today }}</div>
        </div>
    </div>
</div>

<div class="dashboard-main animate-fade-in">
    <!-- Left Column: App Sections -->
    <div class="dashboard-left">
        <div class="row g-4">
            <!-- Autentikasi Section -->
            <div class="col-md-6">
                <div class="glass-card h-100">
                    <div class="card-header-clean mb-4">
                        <i class="fas fa-user-shield" style="color: #3b82f6; font-size: 1.5rem;"></i>
                        <div class="ms-3">
                            <h3 class="card-title-modern text-white"
                                style="font-size: 1.15rem; font-weight: 700; margin: 0;">Autentikasi</h3>
                            <span style="color: #94a3b8; font-size: 0.85rem;">Kelola akses & pengguna sistem</span>
                        </div>
                    </div>
                    <div class="d-flex gap-2 flex-wrap mt-auto">
                        <a href="/admin/auth/group/" class="btn btn-modern-neutral flex-grow-1">Kelola Grup</a>
                        <a href="/admin/auth/user/" class="btn btn-modern-primary flex-grow-1">Kelola Pengguna</a>
                    </div>
                </div>
            </div>

            <!-- HR Management Section -->
            <div class="col-md-6">
                <div class="glass-card h-100">
                    <div class="card-header-clean mb-4">
                        <i class="fas fa-layer-group" style="color: #6366f1; font-size: 1.5rem;"></i>
                        <div class="ms-3">
                            <h3 class="card-title-modern text-white"
                                style="font-size: 1.15rem; font-weight: 700; margin: 0;">HR Management</h3>
                            <span style="color: #94a3b8; font-size: 0.85rem;">Data internal operasional HR</span>
                        </div>
                    </div>
                    <div class="action-list">
                        <a href="/admin/hrd_app/department/" class="action-item">
                            <span>Daftar Departemen</span>
                            <i class="fas fa-arrow-right" style="font-size: 0.75rem; color: #475569;"></i>
                        </a>
                        <a href="/admin/hrd_app/employee/" class="action-item">
                            <span>Database Karyawan</span>
                            <i class="fas fa-arrow-right" style="font-size: 0.75rem; color: #475569;"></i>
                        </a>
                        <a href="/admin/hrd_app/attendance/" class="action-item">
                            <span>Log Kehadiran Harian</span>
                            <i class="fas fa-arrow-right" style="font-size: 0.75rem; color: #475569;"></i>
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Right Column: Recent Activity (Timeline) -->
    <div class="dashboard-right">
        <div class="glass-card">
            <h3 class="card-title-modern text-white mb-4" style="font-size: 1.15rem; font-weight: 700;">Tindakan terbaru
            </h3>
            <div class="timeline-modern">
                {% load log %}
                {% get_admin_log 6 as admin_log for_user user %}
                {% if not admin_log %}
                <p style="color: #94a3b8; font-size: 0.85rem;">Belum ada riwayat aktivitas terbaru.</p>
                {% else %}
                {% for entry in admin_log %}
                <div class="activity-item mb-3">
                    <div class="activity-content p-3">
                        <div class="d-flex justify-content-between align-items-start">
                            <span class="activity-user" style="font-weight: 700; color: #3b82f6; font-size: 0.85rem;">{{
                                entry.user.username }}</span>
                            <span class="activity-time" style="font-size: 0.7rem; color: #64748b;">{{
                                entry.action_time|timesince }} lalu</span>
                        </div>
                        <div class="activity-msg mt-1" style="font-size: 0.85rem; color: #cbd5e1; line-height: 1.5;">
                            {% if entry.is_addition %}Menambahkan{% elif entry.is_change %}Memperbarui{% else
                            %}Menghapus{% endif %}
                            <strong style="color: #f1f5f9;">{{ entry.object_repr|truncatechars:30 }}</strong>
                        </div>
                    </div>
                </div>
                {% endfor %}
                {% endif %}
            </div>
        </div>
    </div>
</div>

<style>
    #content>.row:last-child {
        display: none !important;
    }

    .animate-fade-in {
        animation: dashboardFadeIn 0.6s ease-out forwards;
    }

    @keyframes dashboardFadeIn {
        from {
            opacity: 0;
            transform: translateY(15px);
        }

        to {
            opacity: 1;
            transform: translateY(0);
        }
    }
</style>

<script>
    document.addEventListener('DOMContentLoaded', function () {
        // Branding Update
        const brandText = document.querySelector('.brand-link .brand-text');
        if (brandText) brandText.innerText = 'HR Portal';

        const logoIcon = document.querySelector('.brand-link .brand-image');
        if (logoIcon) {
            logoIcon.style.cssText = 'background: #3b82f6; border-radius: 8px; width: 32px; height: 32px; display: flex; align-items: center; justify-content: center; font-weight: 900; color: #fff; margin-right: 12px;';
            logoIcon.innerHTML = 'H';
        }
    });
</script>
{% endblock %}